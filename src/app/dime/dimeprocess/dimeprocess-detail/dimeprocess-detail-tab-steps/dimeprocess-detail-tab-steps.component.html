<div class="btn-toolbar" role="toolbar">
	<div class="btn-group btn-group-xs" role="group">
		<button class="btn btn-default" type="button" title="New step" (click)="mainService.stepCreate()"><i class="fa fa-plus fa-fw"></i> New Step</button>
		<button class="btn btn-default" type="button" title="Refresh Steps" (click)="mainService.stepGetAll()"><i class="fa fa-refresh fa-fw" aria-hidden="true"></i> Refresh Steps</button>
		<button class="btn btn-default" type="button" title="Save Steps" (click)="mainService.stepSaveAll()"><i class="fa fa-floppy-o fa-fw" aria-hidden="true"></i> Save Changes</button>
	</div>
</div>
<hr>
<div class="well well-warning well-sm" *ngIf="!mainService.curItemIsPrepared">
	This map definition is not ready for processing. <br>
	<b>Issue List:</b>
	<ol>
		<li *ngFor="let issue of mainService.curItemIssueList">{{issue}}</li>
	</ol>
</div>
<table class="table table-hover table-condensed">
	<thead>
		<tr>
			<th>Type</th>
			<th>Reference</th>
			<th>Details</th>
			<th>Actions</th>
			<th>Re-Order</th>
		</tr>
	</thead>
	<tbody>
		<tr *ngFor="let step of mainService.curItemSteps;let last = last; let first = first;">
			<td>
				<span *ngFor="let steptype of mainService.stepTypes">
					<span *ngIf="step.type == steptype.value">{{ steptype.name }}</span>
				</span>
			</td>
			<td>
				<span *ngIf="step.type == 'srcprocedure' ">
					<span *ngIf="!step.referedid">Please select an environment for the process.</span>
					<span *ngIf="step.referedid">
						<span *ngFor="let environment of environmentService.items | async;">
							<span *ngIf="environment.id == step.referedid">{{ environment.name }}</span>
						</span>
					</span>
				</span>
				<span *ngIf="step.type == 'pulldata' ">
					<span *ngIf="!step.referedid">Please edit the step and select a stream.</span>
					<span *ngIf="step.referedid">
						<span *ngFor="let stream of streamService.items | async;">
							<span *ngIf="stream.id == step.referedid">{{ stream.name }}</span>
						</span>
					</span>
				</span>
				<span *ngIf="step.type == 'mapdata' ">
					<span *ngIf="!step.referedid">Please edit the step and select a map.</span>
					<span *ngIf="step.referedid">
						<span *ngFor="let map of mapService.items | async;">
							<span *ngIf="map.id == step.referedid">{{ map.name }}</span>
						</span>
					</span>
				</span>
				<span *ngIf="step.type == 'pushdata'">
					<span *ngIf="!step.referedid">Please edit the step and select a stream.</span>
					<span *ngIf="step.referedid">
						<span *ngFor="let stream of streamService.items | async;">
							<span *ngIf="stream.id == step.referedid">{{ stream.name }}</span>
						</span>
					</span>
				</span>
				<span *ngIf="step.type == 'tarprocedure' ">
					<span *ngIf="!step.referedid">Please select an environment for the process.</span>
					<span *ngIf="step.referedid">
						<span *ngFor="let environment of environmentService.items | async;">
							<span *ngIf="environment.id == step.referedid">{{ environment.name }}</span>
						</span>
					</span>
				</span>
			</td>
			<td>
				{{ mainService.stepDetailPresenter(step.details, step.type) }}
			</td>
			<td width="80">
				<div class="btn-toolbar" role="toolbar" aria-label="Process Steps Actions">
					<div class="btn-group btn-group-xs">
						<button type="button" class="btn btn-default" [routerLink]="['../../process-step-detail', step.id]" title="Edit Step"><i class="fa fa-pencil fa-fw"></i></button>
					</div>
					<div class="btn-group btn-group-xs pull-right">
						<button type="button" class="btn btn-danger" title="Delete Step" (click)="mainService.stepDelete(step.id)"><i class="fa fa-trash fa-fw"></i></button>
					</div>
				</div>
			</td>
			<td>
				<button type="button" *ngIf="!last" class="btn btn-xs btn-default" title="Move Down" (click)="mainService.stepMoveOrder(step, 'down')"><i class="fa fa-caret-down fa-fw" aria-hidden="true"></i></button>
				<button type="button" *ngIf="last || first" class="btn btn-xs btn-default" title="Nothing to do!"><i class="fa fa-fw" aria-hidden="true"></i></button>
				<button type="button" *ngIf="!first" class="btn btn-xs btn-default" title="Move Up" (click)="mainService.stepMoveOrder(step, 'up')"><i class="fa fa-caret-up fa-fw" aria-hidden="true"></i></button>
			</td>
		</tr>
	</tbody>
</table>
